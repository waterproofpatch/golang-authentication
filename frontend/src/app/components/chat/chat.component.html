<div class="container">
	<div class="panel left-panel">
		<mat-form-field class="username-input">
			<mat-label>Username</mat-label>
			<input disabled="{{(isConnected() | async) || (authenticationService.isAuthenticated)}}"
				matInput [(ngModel)]="username">
		</mat-form-field>
		<mat-form-field class="username-input">
			<mat-label>Channel</mat-label>
			<input disabled="{{isConnected() | async}}" matInput [(ngModel)]="channel">
		</mat-form-field>
		<button mat-raised-button color="primary" *ngIf="isDisconnected() | async"
			(click)="joinChannel()">Join</button>
		<button mat-raised-button color="warn" *ngIf="isConnected() | async"
			(click)="leaveChannel()">Leave</button>
		<mat-divider></mat-divider>
		<app-user (click)="pmUser(user.username)" [username]="username" [user]="user" class="user-list"
			*ngFor="let user of users"></app-user>
	</div>
	<div class="panel right-panel">
		<mat-tab-group (selectedTabChange)="pmUserSelect($event)" dynamicHeight>
			<mat-tab label="{{channel}}">
				<div class="messages" #scrollMe>
					<div *ngFor="let message of messages">
						<app-message *ngIf="message.pmUsername == ''"
							[class.message-theirs]="message.from !== username"
							[class.message-mine]="message.from==username"
							[message]="message"></app-message>
					</div>
				</div>
			</mat-tab>
			<!-- label here only for the event so we can get the username to pm to, the displayed 
			label comes from the ng-template mat-tab-label. -->
			<mat-tab label="{{selectedUsername}}" *ngFor="let selectedUsername of selectedUsernames">
				<ng-template mat-tab-label>{{selectedUsername}}
					<button style="color:black" mat-icon-button
						(click)="removeTab(selectedUsername)">
						<mat-icon>close</mat-icon>
					</button>
				</ng-template>
				<ng-template matTabContent>
					<div class="messages" #scrollMe>
						<div *ngFor="let message of messages">
							<app-message
								*ngIf="(message.from == selectedUsername || message.from == username) && message.pmUsername != ''"
								[class.message-theirs]="message.from !== username"
								[class.message-mine]="message.from==username"
								[message]="message"></app-message>
						</div>
					</div>
				</ng-template>
			</mat-tab>
			<!-- <mat-tab label="Second"> Content 2 </mat-tab>
			<mat-tab label="Third"> Content 3 </mat-tab> -->
		</mat-tab-group>
	</div>
	<div class="footer">
		<textarea [(ngModel)]="message" (keyup.enter)="sendMessage()"></textarea>
		<button (click)="sendMessage()"><i class="material-icons">send</i></button>
	</div>
</div>