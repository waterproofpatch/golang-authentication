<div class="container">
	<div *ngIf="isLoading">Loading plants - hang tight...</div>
	<div *ngIf="!isLoading">

		<mat-button-toggle-group #group="matButtonToggleGroup">
			<mat-button-toggle value="uncondensed" [checked]="!condensedView"
				(change)="viewModeChanged(false)">
				<mat-icon>unfold_more</mat-icon>
			</mat-button-toggle>
			<mat-button-toggle value="condensed" [checked]="condensedView" (change)="viewModeChanged(true)">
				<mat-icon>unfold_less</mat-icon>
			</mat-button-toggle>
		</mat-button-toggle-group>
		<mat-button-toggle-group name="filters" aria-label="Filters" multiple>
			<mat-button-toggle value="needsWatering" [checked]="filters.get('needsWatering')"
				(change)="filterChange('needsWatering')">Needs
				Watering</mat-button-toggle>
			<mat-button-toggle value="mineOnly" [checked]="filters.get('onlyMyPlants')"
				(change)="filterChange('onlyMyPlants')">Only My
				Plants</mat-button-toggle>
		</mat-button-toggle-group>

		<button mat-button mat-raised-button color="primary" *ngIf="!addOrEditMode"
			(click)="addOrEditMode=true">Add
			Plant</button>
		<div *ngIf="addOrEditMode">
			<div class="button-group-top">
				<button mat-button mat-raised-button color="warn" *ngIf="addOrEditMode"
					(click)="cancelAddMode(); $event.preventDefault()">Cancel</button>
			</div>

			<form (ngSubmit)="addPlant()" [formGroup]="form" *ngIf="form">
				<mat-form-field hintLabel="Max 30 characters" appearance="fill">
					<mat-label>Plant Name</mat-label>
					<input matInput formControlName="name" #input maxlength="30">
					<mat-hint align="end">{{input.value.length}}/30</mat-hint>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Watering Frequency</mat-label>
					<mat-select formControlName="wateringFrequency">
						<mat-option *ngFor="let option of wateringFrequencyOptions"
							[value]="option">
							{{ option }} day{{ option !== 1 ? 's' : '' }}
						</mat-option>
					</mat-select>
				</mat-form-field>
				<mat-form-field appearance="fill">
					<mat-label>Last Watered Date</mat-label>
					<input matInput formControlName="lastWateredDate" [matDatepicker]="picker">
					<mat-hint>MM/DD/YYYY</mat-hint>
					<mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
					<mat-datepicker #picker></mat-datepicker>
				</mat-form-field>

				<mat-checkbox formControlName="doNotify" class="example-margin">Email
					Notifications</mat-checkbox>
				<mat-radio-group formControlName="publicOrPrivate">
					<mat-radio-button value="public">Public</mat-radio-button>
					<mat-radio-button value="private">Private</mat-radio-button>
				</mat-radio-group>
				<button type="button" mat-raised-button (click)="fileInput.click()">Plant
					Picture</button>
				<input hidden (change)="onImageSelected($event)" #fileInput type="file" id="file">
				<img id="preview" [src]="selectedImagePreview_safe" />
				<div class="button-group">
					<button *ngIf="editingPlant" mat-button mat-raised-button color="primary"
						type="submit">Update</button>
					<button *ngIf="!editingPlant" mat-button mat-raised-button color="primary"
						type="submit">Add</button>
				</div>

			</form>
		</div>
	</div>
</div>
<div class="plants" *ngIf="!addOrEditMode">
	<div *ngFor="let plant of plants | async">
		<div
			*ngIf="(!filters.get('onlyMyPlants') || plant.email == authenticationService.email()) && (!filters.get('needsWatering') || needsWatering(plant))">
			<app-plant [isCondensed]="condensedView" (editModeEmitter)="editPlant($event)"
				[plant]="plant"></app-plant>
		</div>
	</div>
	<!-- <app-plant [isCondensed]="condensedView" (editModeEmitter)="editPlant($event)"
		*ngFor="let plant of plants | async" [plant]="plant"></app-plant> -->
</div>